<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.animation.FadeTransition?>
<?import javafx.animation.ScaleTransition?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ListView?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.effect.DropShadow?>
<?import javafx.scene.effect.InnerShadow?>
<?import javafx.scene.paint.Color?>
<?import javafx.scene.paint.LinearGradient?>
<?import javafx.scene.paint.Stop?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.shape.Circle?>
<?import javafx.util.Duration?>

<StackPane xmlns="http://javafx.com/javafx/23.0.1"
           xmlns:fx="http://javafx.com/fxml/1"
           fx:controller="tn.cinema.Controllers.Notification">

    <!-- Main Container with Animation -->
    <VBox fx:id="mainContainer" prefHeight="550.0" prefWidth="380.0" spacing="14.0"
          style="-fx-background-color: linear-gradient(to bottom right, #ffffff, #f0f5ff);
                 -fx-background-radius: 20;
                 -fx-border-color: rgba(197, 202, 233, 0.7);
                 -fx-border-radius: 20;
                 -fx-border-width: 1.2;">

        <effect>
            <DropShadow radius="18.0" spread="0.1">
                <color>
                    <Color opacity="0.35" />
                </color>
            </DropShadow>
        </effect>

        <padding>
            <Insets bottom="20.0" left="22.0" right="22.0" top="20.0"/>
        </padding>

        <children>
            <!-- Stylish Header with Animated Bell -->
            <HBox alignment="CENTER_LEFT" spacing="14.0">
                <children>
                    <!-- Animated Bell Icon Container -->
                    <StackPane fx:id="bellIconContainer" minWidth="40" minHeight="40">
                        <Circle radius="20" centerX="20" centerY="20"
                                style="-fx-fill: linear-gradient(to bottom right, #3f51b5, #5c6bc0);" />
                        <Text fx:id="notificationEmoji" text="ðŸ””"
                              style="-fx-font-size: 20px; -fx-fill: white;" />
                    </StackPane>

                    <VBox spacing="2">
                        <Label text="Notifications"
                               style="-fx-font-size: 22px; -fx-font-weight: bold; -fx-text-fill: #303f9f;" />

                    </VBox>

                    <Region HBox.hgrow="ALWAYS" />

                    <Label fx:id="notificationCount" text="0 nouvelles"
                           style="-fx-font-size: 14px;
                                  -fx-font-weight: bold;
                                  -fx-text-fill: #303f9f;
                                  -fx-background-color: #e8eaf6;
                                  -fx-background-radius: 16;
                                  -fx-padding: 6 14 6 14;">
                        <effect>
                            <InnerShadow choke="0.1" radius="2" width="2" height="2">
                                <color>
                                    <Color opacity="0.1" />
                                </color>
                            </InnerShadow>
                        </effect>
                    </Label>
                </children>

                <VBox.margin>
                    <Insets bottom="8.0" />
                </VBox.margin>
            </HBox>

            <!-- Action Buttons with Improved Style -->
            <HBox spacing="12.0" alignment="CENTER_LEFT">
                <children>
                    <Button text="Tout voir" onAction="#recupererEtAfficherNotifications"
                            style="-fx-background-color: linear-gradient(to right, #3f51b5, #5c6bc0);
                                   -fx-background-radius: 18;
                                   -fx-text-fill: white;
                                   -fx-font-weight: bold;
                                   -fx-effect: dropshadow(three-pass-box, rgba(63, 81, 181, 0.5), 6, 0, 0, 2);"
                            prefWidth="120.0" prefHeight="36.0"/>

                    <Region HBox.hgrow="ALWAYS" />
                    <Button text="Fermer" onAction="#closeWindow"
                            style="-fx-background-color: white;
                                   -fx-background-radius: 18;
                                   -fx-text-fill: #f44336;
                                   -fx-border-color: #f44336;
                                   -fx-border-radius: 18;
                                   -fx-border-width: 1.5;"
                            prefWidth="80.0" prefHeight="36.0"/>
                </children>

                <VBox.margin>
                    <Insets bottom="8.0" />
                </VBox.margin>
            </HBox>

            <!-- Custom ScrollPane with Styled ListView -->
            <ScrollPane fitToWidth="true" fitToHeight="true"
                        style="-fx-background-color: transparent; -fx-background: transparent;"
                        VBox.vgrow="ALWAYS">
                <content>
                    <ListView fx:id="notificationListView"
                              style="-fx-background-radius: 16;
                                    -fx-background-color: rgba(255, 255, 255, 0.7);
                                    -fx-border-color: rgba(197, 202, 233, 0.5);
                                    -fx-border-radius: 16;
                                    -fx-border-width: 1;
                                    -fx-padding: 5;
                                    -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 2);" />
                </content>
            </ScrollPane>

            <!-- Status Bar at Bottom -->
            <HBox alignment="CENTER_LEFT" opacity="0.75">
                <children>
                    <Circle radius="4" style="-fx-fill: #4CAF50;" />
                    <Label text="ConnectÃ©" style="-fx-font-size: 12px; -fx-text-fill: #4CAF50;">
                        <HBox.margin>
                            <Insets left="6.0" />
                        </HBox.margin>
                    </Label>
                    <Region HBox.hgrow="ALWAYS" />
                    <Label fx:id="lastUpdateLabel" text="DerniÃ¨re mise Ã  jour: 12:30"
                           style="-fx-font-size: 11px; -fx-text-fill: #7986cb;" />
                </children>

                <VBox.margin>
                    <Insets top="6.0" />
                </VBox.margin>
            </HBox>
        </children>
    </VBox>

    <!-- Define animation for bell icon -->
    <fx:define>
        <ScaleTransition fx:id="bellAnimation"
                         fromX="1.0" fromY="1.0"
                         toX="1.2" toY="1.2"
                         duration="500ms"
                         node="${bellIconContainer}"
                         autoReverse="true"
                         cycleCount="2" />
    </fx:define>
</StackPane>